# Payment Gateway Integration Alerts
# Owner: Payments Team (@payments-oncall)
# Last Updated: 2024-09-15

groups:
  - name: payment-gateway.connectivity
    interval: 30s
    rules:
      - alert: StripeAPIUnreachable
        expr: probe_success{job="blackbox-exporter", target="https://api.stripe.com/v1/health"} == 0
        for: 2m
        labels:
          severity: critical
          team: payments
          service: payment-service
          tier: external
          pagerduty: enabled
        annotations:
          summary: "Stripe API is unreachable"
          description: "Cannot reach Stripe API. All card payments will fail. Check Stripe status page."
          runbook_url: "https://runbooks.techcorp.io/payment-service/stripe-unreachable"
          dashboard_url: "https://grafana.techcorp.io/d/payment-gateways"
          slack_channel: "#payments-alerts"

      - alert: PayPalAPIUnreachable
        expr: probe_success{job="blackbox-exporter", target="https://api.paypal.com/v1/health"} == 0
        for: 2m
        labels:
          severity: warning
          team: payments
          service: payment-service
          tier: external
        annotations:
          summary: "PayPal API is unreachable"
          description: "Cannot reach PayPal API. PayPal payments will fail, but card payments via Stripe should still work."
          runbook_url: "https://runbooks.techcorp.io/payment-service/paypal-unreachable"
          dashboard_url: "https://grafana.techcorp.io/d/payment-gateways"
          slack_channel: "#payments-alerts"

  - name: payment-gateway.latency
    interval: 30s
    rules:
      - alert: StripeAPIHighLatency
        expr: |
          histogram_quantile(0.95, 
            sum(rate(payment_gateway_request_duration_seconds_bucket{job="payment-service", gateway="stripe"}[5m])) by (le)
          ) > 5.0
        for: 5m
        labels:
          severity: warning
          team: payments
          service: payment-service
          tier: external
        annotations:
          summary: "High latency to Stripe API"
          description: "P95 latency to Stripe API is {{ $value | humanizeDuration }}. Customer checkout experience is degraded."
          runbook_url: "https://runbooks.techcorp.io/payment-service/stripe-latency"
          dashboard_url: "https://grafana.techcorp.io/d/payment-gateways"
          slack_channel: "#payments-alerts"


